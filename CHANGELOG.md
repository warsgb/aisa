# Changelog

## [v2.0.2] - 2026-02-24

### 技能参数优化 - AI智能识别

#### 竞品反制策略报告 (presale-competitor-response)
- **移除"客户类型"参数**：改为AI根据客户名称自动判断（国企/金融/政府/民企）
- **新增"客户名称"必填参数**：支持自动填充当前客户
- **新增"企微"竞品选项**：扩展竞品反制策略覆盖范围
- **更新技能内容**：为各客户类型新���企微反制策略和对比表
- **优化用户体验**：减少用户手动选择，提升智能化水平

#### 商务谈判筹码方案 (presale-negotiation-chips)
- **移除"筹码类型偏好"参数**：默认生成所有筹码类型（品牌/服务/账期/产品组合）
- **简化操作流程**：用户无需手动选择筹码类型，系统自动提供全面方案

#### 标书响应文档生成助手 (proposal-creater)
- **移除"客户行业"参数**：改为AI根据客户名称自动判断（金融/政府/能源/制造/军工/教育/医疗等）
- **"客户名称"改为必填**：支持自动填充当前客户
- **"参考项目案例"改为多行文本框**：支持粘贴案例内容
- **新增AI行业识别规则**：基于客户名称关键词自动识别行业

### 文档更新
- 更新 `skills/shared-frameworks/README.md` 中的竞品反制策略报告技能说明
- 添加企微到支持竞品列表

---

## [v2.0.1] - 2026-02-21

### 新增功能

#### 技能参数中英文显示
- 技能执行弹窗中，参数标签同时显示中文和英文
- 格式：`中文标签 (英文参数名)`，例如：`目标角色`
- 所有技能页面统一显示格式（首页、技能中心、技能管理）

#### 技能参数标签编辑功能
- 技能管理页面支持直接编辑参数的中文标签
- 点击参数标签即可修改，无需编辑文件
- 保存后自动更新 SKILL.md 文件并重新加载技能
- 支持在 SKILL.md 中通过 `label` 字段自定义标签

#### 技能执行状态动态展示
- 技能执行时显示实时进度：准备参数 → 发起请求 → 等待响应 → 接收数据
- 可视化进度条和状态指示器
- 提升用户体验，清晰展示执行阶段

#### 交互历史消息编辑
- 交互详情页面支持编辑已生成的消息内容
- 点击消息旁的"编辑"按钮即可修改
- 使用 MDEditor 编辑 Markdown 格式内容
- 保存后更新消息记录

#### 导航优化
- 交互详情页面新增"返回首页"按钮
- 方便用户快速返回

### 后端改进

#### 技能参数处理优化
- 支持 SKILL.md 中的 `label` 字段定义中文标签
- 如果未定义 `label`，使用后端默认映射表自动翻译
- 扩展参数名映射表，支持更多技能参数
- 新增 API：`PUT /skills/:id/parameter-labels` 更新参数标签

#### 技能文件管理
- 支持导入 ZIP 格式的技能包（多文件技能）
- 技能文件浏览和管理功能
- 支持查看和编辑技能目录中的所有文件

### Bug 修复

#### 首页交互历史过滤
- 修复首页交互历史未按选定客户过滤的问题
- 修复zustand persist hydration 异步导致的时序问题
- 客户切换后正确过滤显示该客户的交互记录

#### 技能参数显示
- 修复部分技能参数只显示英文的问题
- 统一所有页面的参数显示格式

### 用户体验提升
- 技能模板功能（空白模板、简单技能、售前技能）
- 技能导入支持 ZIP 压缩包
- 多文件技能管理
- 参数标签可视化编辑

---

## [v2.0.0] - 2026-02-20

### 新增功能

#### LTC 销售流程管理
- 实现完整的 Lead To Cash (LTC) 销售流程管理
- 默认 8 个流程节点：线索 → 商机 → 方案 → POC → 商务谈判 → 成交签约 → 交付验收 → 运营&增购
- 支持自定义节点配置（添加、编辑、删除）
- 拖拽排序功能（使用 @dnd-kit）

#### 节点-技能绑定
- 每个 LTC 节点可绑定多个技能
- 技能按节点分类展示
- 首页横向流程图展示节点和绑定技能

#### 首页全新设计
- 顶部客户选择器（支持搜索和下拉选择）
- LTC 横向流程时间线（8 个节点卡片）
- 技能筛选功能（我的常用技能 / 全部技能）
- 底部历史记录时间线

#### 铁三角角色系统
- AR（客户经理）- 负责客户关系维护和商务谈判
- SR（解决方案经理）- 负责解决方案设计和技术支持
- FR（交付经理）- 负责项目交付和售后服务
- 用户可在设置中选择自己的角色
- 支持收藏常用技能

#### 客户背景资料
- 每个客户可维护 MD 格式的背景资料
- 包含：历史合作信息、决策链、其他备注

#### 系统管理员功能
- 添加 `SYSTEM_ADMIN` 系统管理员角色
- 创建 `SystemAdminGuard` 守卫，用于权限控制
- 创建系统管理模块 (`/system`)
  - 系统统计：显示用户数、团队数、团队成员数
  - 用户管理：查看、创建、禁用/启用用户、重置密码
  - 团队管理：查看、创建、删除团队、查看团队成员
  - 团队申请：查看、审核（批准/拒绝）团队创建申请

#### 团队申请流程
- 普通用户可在设置页面申请创建新团队
- 系统管理员可审核申请
- 批准后自动创建团队并设置为申请人所有者

#### 移除用户自注册
- 移除注册页面和路由
- 登录页面提示"请联系系统管理员创建账号"
- 用户账号只能由系统管理员创建

### 后端新增

#### 新增实体
- `LtcNode` - LTC 流程节点
- `NodeSkillBinding` - 节点-技能绑定关系
- `CustomerProfile` - 客户背景资料
- `TeamMemberPreference` - 团队成员偏好设置

#### 新增 API
- `/teams/:teamId/ltc-nodes` - LTC 节点 CRUD
- `/teams/:teamId/ltc-nodes/reorder` - 节点排序
- `/teams/:teamId/ltc-nodes/reset` - 重置默认节点
- `/teams/:teamId/ltc-nodes/:nodeId/bindings` - 技能绑定
- `/teams/:teamId/customers/:customerId/profile` - 客户资料
- `/teams/:teamId/members/:memberId/preference` - 成员偏好
- `/teams/:teamId/home` - 首页聚合数据

### 前端优化

#### UI/UX 改进
- 统一项目主色：#1677FF
- 深色侧边栏导航（#1E293B）
- 固定顶部导航栏
- 左侧菜单优化
- 技能卡片样式优化
- 响应式布局调整

#### 新增组件
- `src/components/customer/` - 客户相关组件
- `src/components/ltc/` - LTC 流程组件
- `src/components/skill/` - 技能组件
- `src/components/interaction/` - 交互组件

#### 新增页面
- 首页 - LTC 横向流程展示
- LTC 配置页面 - 节点管理和技能绑定
- 技能管理子页面 - 技能列表管理

#### 新增状态管理
- `ltcConfig.store.ts` - LTC 配置状态
- `currentCustomer.store.ts` - 当前客户状态
- `skillFilter.store.ts` - 技能筛选状态

### 测试
- 创建测试账号：ltctest@example.com / LtcTest123
- 添加测试客户数据
- 验证完整业务流程

---

## [Unreleased]

### 新增功能

#### 系统管理员功能
- 添加 `SYSTEM_ADMIN` 系统管理员角色
- 创建 `SystemAdminGuard` 守卫，用于权限控制
- 创建系统管理模块 (`/system`)
  - 系统统计：显示用户数、团队数、团队成员数
  - 用户管理：查看、创建、禁用/启用用户、重置密码
  - 团队管理：查看、创建、删除团队、查看团队成员
  - 团队申请：查看、审核（批准/拒绝）团队创建申请

#### 团队申请流程
- 普通用户可在设置页面申请创建新团队
- 系统管理员可审核申请
- 批准后自动创建团队并设置为申请人所有者

#### 移除用户自注册
- 移除注册页面和路由
- 登录页面提示"请联系系统管理员创建账号"
- 用户账号只能由系统管理员创建

### 代码优化
- 扩展 TypeScript 类型定义
- 更新 API 服务，添加系统管理相关接口
- 优化前端组件加载状态处理

### Bug 修复
- 修复用户 ID 提取问题（JWT payload 格式）
- 修复团队申请审核时的类型错误
- 修复设置页面无团队时的加载状态

---

## Previous Releases

See commit history for previous changes.
